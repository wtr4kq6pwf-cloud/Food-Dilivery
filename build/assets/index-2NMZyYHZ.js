import{c as Re,r as a,j as e,u as ke,A as Ie,G as Ee,M as ue,a as Me}from"./vendor-Vxub6Q0z.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const m of i)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function x(i){const m={};return i.integrity&&(m.integrity=i.integrity),i.referrerPolicy&&(m.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?m.credentials="include":i.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function s(i){if(i.ep)return;i.ep=!0;const m=x(i);fetch(i.href,m)}})();const Le="https://dtdmjahutopbogysdcba.supabase.co",Te="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0ZG1qYWh1dG9wYm9neXNkY2JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NjUyMjgsImV4cCI6MjA3NzQ0MTIyOH0.qxTeCv64luk4qz9ES7vFdHSR1hOq3nplkFf-t1Lop4g",E=Re(Le,Te),Be=()=>{const[n,u]=a.useState(null),[x,s]=a.useState(!1);return a.useEffect(()=>{const{data:{subscription:i}}=E.auth.onAuthStateChange((m,h)=>{u((h==null?void 0:h.user)??null),s(!0)});return E.auth.getSession().then(({data:{session:m}})=>{u((m==null?void 0:m.user)??null),s(!0)}),()=>{i==null||i.unsubscribe()}},[]),{supabase:E,user:n,authReady:x}},R="var(--shopee-orange)",q="black",Ue="var(--shopee-light-bg)",V="var(--shopee-border)",pe={lat:8.228,lng:124.2452},Y=["Preparing","Out for Delivery","Delivered","Completed","Cancelled"],qe="AIzaSyAOVYRIgupAurZup5y1PRh8Ismb1A3lLao",xe=()=>e.jsxs("div",{className:"flex items-center justify-center p-8 h-full w-full",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-t-transparent",style:{borderColor:R}}),e.jsx("span",{className:"ml-4 text-lg font-medium",style:{color:q},children:"Loading Iligan Food..."})]}),W=({children:n,onClick:u,className:x="",disabled:s=!1,variant:i="primary"})=>{const m="w-full py-3 rounded-md font-bold text-base transition-all duration-300 shadow-lg";let h="",d={};i==="primary"?h="btn-primary":(h="bg-white text-gray-700 border border-gray-300 hover:bg-gray-100 shadow-md",d={color:q});const r=s?"opacity-60 cursor-not-allowed shadow-none":"";return e.jsx("button",{onClick:u,disabled:s,className:`${m} ${h} ${r} ${x}`,style:d,children:n})},ae=({type:n="text",placeholder:u,value:x,onChange:s,rows:i=1,required:m=!1,isTextArea:h=!1})=>{const d="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-offset-0 transition duration-150 ease-in-out input-focus-shopee";return h?e.jsx("textarea",{placeholder:u,value:x,onChange:s,rows:i,required:m,className:`${d} resize-none`}):e.jsx("input",{type:n,placeholder:u,value:x,onChange:s,required:m,className:d})},$e=({onSuccess:n})=>{const[u,x]=a.useState(""),[s,i]=a.useState(""),[m,h]=a.useState(!0),[d,r]=a.useState(""),c=async()=>{if(r(""),!u||!s){r("Please fill in both fields.");return}try{let g;if(m?g=await E.auth.signInWithPassword({email:u,password:s}):g=await E.auth.signUp({email:u,password:s}),g.error)throw new Error(g.error.message);g.data.user?n():g.data.session===null&&!m&&(r("Account created. Please check your email to confirm your account before logging in."),h(!0))}catch(g){console.error(g),r(g.message||"Authentication failed.")}};return e.jsx("div",{className:"flex justify-center items-center h-full w-full py-10",children:e.jsxs("div",{className:"p-6 md:p-10 bg-white rounded-2xl shadow-2xl mx-4 w-full max-w-md",children:[e.jsx("h2",{className:"text-3xl font-extrabold mb-8 text-center",style:{color:R},children:m?"Welcome Back to Iligan Food!":"Join the Food Delivery Family"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{type:"email",placeholder:"Email Address",value:u,onChange:g=>x(g.target.value)}),e.jsx(ae,{type:"password",placeholder:"Password",value:s,onChange:g=>i(g.target.value)})]}),d&&e.jsx("p",{className:"text-sm text-red-500 mt-4 font-medium",children:d}),e.jsx("div",{className:"mt-8",children:e.jsx(W,{onClick:c,children:m?"Login Securely":"Sign Up Now"})}),e.jsxs("p",{className:"mt-6 text-center text-gray-500 text-sm",children:[m?"Don't have an account?":"Already have an account?",e.jsx("button",{onClick:()=>{h(!m),r("")},className:"ml-2 font-bold hover:underline",style:{color:R},children:m?"Sign Up":"Login"})]})]})})},Ge=({user:n,onClose:u})=>{const[x,s]=a.useState({full_name:"",phone:"",address:"",barangay:""}),[i,m]=a.useState(!1),[h,d]=a.useState("");a.useEffect(()=>{if(!(n!=null&&n.id))return;let c=!1;return(async()=>{try{const{data:l,error:N}=await E.from("user_profiles").select("full_name, phone, address, barangay").eq("id",n.id).single();if(c||N)return;l&&s({full_name:l.full_name||"",phone:l.phone||"",address:l.address||"",barangay:l.barangay||""})}catch{}})(),()=>{c=!0}},[n]);const r=async()=>{if(n!=null&&n.id){m(!0),d("");try{const c={id:n.id,full_name:x.full_name,phone:x.phone,address:x.address,barangay:x.barangay},{error:g}=await E.from("user_profiles").upsert(c);if(g)throw g;d("Profile saved."),u&&setTimeout(u,900)}catch{d("Failed to save profile.")}finally{m(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.45)"},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md",style:{border:`1px solid ${V}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",style:{color:q},children:"Your Profile"}),e.jsx("button",{onClick:u,className:"text-gray-500 font-semibold",children:"Close"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ae,{placeholder:"Full name",value:x.full_name,onChange:c=>s(g=>({...g,full_name:c.target.value}))}),e.jsx(ae,{placeholder:"Phone number",value:x.phone,onChange:c=>s(g=>({...g,phone:c.target.value}))}),e.jsx(ae,{placeholder:"Street / Unit / House No.",value:x.address,onChange:c=>s(g=>({...g,address:c.target.value})),isTextArea:!0,rows:2}),e.jsx(ae,{placeholder:"Barangay",value:x.barangay,onChange:c=>s(g=>({...g,barangay:c.target.value}))})]}),h&&e.jsx("p",{className:"text-sm text-gray-700 mt-3",children:h}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsx(W,{onClick:r,disabled:i,style:{backgroundColor:R},children:i?"Saving...":"Save Profile"}),e.jsx("button",{onClick:u,className:"flex-1 py-3 rounded-lg border font-semibold",style:{borderColor:V},children:"Cancel"})]})]})})},he=({icon:n,title:u})=>e.jsxs("h3",{className:"flex items-center text-xl font-extrabold mb-4",style:{color:q},children:[e.jsx("span",{className:"mr-2 text-2xl",children:n}),u]}),Ce=({setPage:n,cart:u,setCart:x})=>{const[s,i]=a.useState([]),[m,h]=a.useState([]),[d,r]=a.useState(!0),[c,g]=a.useState(null),[l,N]=a.useState(null);a.useEffect(()=>{(async()=>{r(!0);const{data:w,error:O}=await E.from("categories").select("*").order("name",{ascending:!0});O?console.error("Error fetching categories:",O):h(w);const{data:A,error:S}=await E.from("food_items").select(`
          food_item_id,
          name,
          price,
          stock,
          image_url,
          description,
          restaurants (
            id,
            name,
            image_url,
            address_barangay,
            is_open,
            categories (
              id,
              name,
              icon_url
            )
          )
        `).eq("restaurants.is_open",!0);if(S)console.error("Error fetching food items:",S);else{const B=A.filter(C=>C.restaurants).map(C=>{var L;return{...C,id:C.food_item_id,restaurant_id:C.restaurants.id,restaurant_name:C.restaurants.name,restaurant_image_url:C.restaurants.image_url,category_name:((L=C.restaurants.categories)==null?void 0:L.name)||"Uncategorized"}});i(B)}r(!1)})()},[]);const y=a.useMemo(()=>{let p=s;return l&&(p=p.filter(w=>w.category_name===l.name)),c&&(p=p.filter(w=>w.restaurant_id===c.id)),p},[s,l,c]),D=a.useMemo(()=>y.reduce((p,w)=>{const{restaurant_id:O,restaurant_name:A,restaurant_image_url:S}=w;return p[O]||(p[O]={id:O,name:A,image_url:S,items:[]}),p[O].items.push(w),p},{}),[y]),k=a.useMemo(()=>Object.values(D),[D]),b=a.useCallback((p,w=1)=>{x(O=>O.find(S=>S.id===p.id)?O.map(S=>S.id===p.id?{...S,quantity:S.quantity+w}:S):[...O,{...p,quantity:w,restaurant_name:p.restaurant_name}])},[x]),M=a.useMemo(()=>u.reduce((p,w)=>p+w.quantity,0),[u]);return d?e.jsx(xe,{}):e.jsxs("div",{className:"p-4 md:p-6 mx-auto w-full max-w-3xl",children:[e.jsx(he,{icon:"ðŸ½ï¸",title:"Local Iligan City Delivers"}),e.jsxs("div",{className:"flex overflow-x-auto space-x-2 pb-4 border-b mb-6",style:{borderColor:V},children:[e.jsx("button",{onClick:()=>N(null),className:`px-4 py-2 rounded-full text-sm font-bold flex-shrink-0 transition-colors ${l?"bg-white text-gray-700":"text-white"}`,style:{backgroundColor:l?"white":R,border:`1px solid ${R}`},children:"All Shops"}),m.map(p=>e.jsxs("button",{onClick:()=>N(p),className:`px-4 py-2 rounded-full text-sm font-bold flex-shrink-0 transition-colors flex items-center ${(l==null?void 0:l.id)===p.id?"text-white":"bg-white text-gray-700"}`,style:{backgroundColor:(l==null?void 0:l.id)===p.id?R:"white",border:`1px solid ${R}`},children:[p.icon_url?e.jsx("img",{src:p.icon_url,alt:"",className:"w-4 h-4 mr-1"}):e.jsx("span",{className:"mr-1",children:"ðŸ”"}),p.name]},p.id))]}),e.jsx("div",{className:"space-y-8",children:k.map(p=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:p.image_url,alt:p.name,className:"w-12 h-12 object-cover rounded-full mr-4 border",style:{borderColor:V}}),e.jsx("h3",{className:"text-xl font-extrabold",style:{color:q},children:p.name})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:p.items.map(w=>e.jsxs("div",{className:"p-3 rounded-lg border flex justify-between items-center",style:{border:`1px solid ${V}`},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:w.image_url,alt:w.name,className:"w-12 h-12 object-cover mr-3 rounded",style:{borderColor:V}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold line-clamp-2",children:w.name}),e.jsxs("p",{className:"text-base font-extrabold mt-1",style:{color:R},children:["â‚±",w.price.toFixed(2)]})]})]}),e.jsx(W,{onClick:()=>b(w),variant:"secondary",children:"+ Add"})]},w.id))})]},p.id))}),e.jsx("div",{className:"mt-8",children:e.jsxs(W,{onClick:()=>n("cart"),className:"py-3",disabled:M===0,children:["View Basket (",M,") â†’"]})})]})},ze=({setPage:n,cart:u,setCart:x})=>{const s=Array.isArray(u)?u:[],i=a.useMemo(()=>s.reduce((d,r)=>d+(r.price||0)*(r.quantity||0),0),[s]),m=(d,r)=>{x(c=>(Array.isArray(c)?c:[]).map(N=>N.id===d?{...N,quantity:(N.quantity||0)+r}:N).filter(N=>(N.quantity||0)>0))};if(a.useEffect(()=>{s.length===0&&n("products")},[s,n]),s.length===0)return e.jsxs("div",{className:"p-4 md:p-6 text-center h-full flex flex-col justify-center items-center mx-auto w-full max-w-3xl",children:[e.jsx("span",{className:"text-6xl mb-4",children:"ðŸ›µ"}),e.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:q},children:"Your Basket is Empty!"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"Time to order from Iligan's finest."}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsx(W,{onClick:()=>n("products"),children:"Start Ordering"})})]});const h=a.useMemo(()=>s.reduce((d,r)=>{const c=r.restaurant_name||"Unspecified Restaurant";return d[c]||(d[c]=[]),d[c].push(r),d},{}),[s]);return e.jsxs("div",{className:"p-4 md:p-6 mx-auto w-full max-w-3xl",children:[e.jsx(he,{icon:"ðŸœ",title:"Review Your Order"}),Object.entries(h).map(([d,r])=>e.jsxs("div",{className:"mb-6 p-4 bg-white rounded-xl shadow-md border",style:{borderColor:V},children:[e.jsx("h4",{className:"font-bold text-lg mb-3",style:{color:q},children:d}),r.map(c=>e.jsxs("div",{className:"flex items-center justify-between pb-3 mb-3 border-b last:border-b-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center flex-grow",children:[e.jsx("img",{src:c.image_url,alt:c.name,className:"w-12 h-12 object-cover rounded-md mr-4 border",style:{borderColor:V}}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-800 line-clamp-2",children:c.name}),e.jsxs("p",{className:"text-sm font-bold mt-1",style:{color:R},children:["â‚±",c.price.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>m(c.id,-1),className:"w-7 h-7 flex items-center justify-center text-lg border rounded-full transition-colors",style:{color:R,borderColor:R},children:"-"}),e.jsx("span",{className:"font-bold w-5 text-center",children:c.quantity}),e.jsx("button",{onClick:()=>m(c.id,1),className:"w-7 h-7 flex items-center justify-center text-lg border rounded-full transition-colors",style:{backgroundColor:R,color:"white",borderColor:R},children:"+"})]})]},c.id))]},d)),e.jsx("div",{className:"mt-8 p-5 bg-white rounded-xl shadow-lg border",style:{borderColor:V},children:e.jsxs("p",{className:"text-xl text-black font-extrabold flex justify-between ",children:[e.jsx("span",{children:"Total Payable:"}),e.jsxs("span",{className:"text-2xl",style:{color:R},children:["â‚±",i.toFixed(2)]})]})}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(W,{onClick:()=>n("checkout"),children:"Proceed to Checkout"}),e.jsx(W,{onClick:()=>n("products"),variant:"secondary",children:"Add More"})]})]})},Ke=["places"],Ye=({onAddressComponents:n=()=>{},onDistanceCalculated:u=()=>{},origin:x={lat:8.228,lng:124.2452}})=>{const s="AIzaSyAOVYRIgupAurZup5y1PRh8Ismb1A3lLao",{isLoaded:i}=ke({googleMapsApiKey:s,libraries:Ke}),[m,h]=a.useState(x),[d,r]=a.useState(x),[c,g]=a.useState(null),l=a.useCallback(k=>{if(!window.google)return;new window.google.maps.Geocoder().geocode({location:k},(M,p)=>{if(p==="OK"&&M&&M.length>0){const w=M.find(S=>S.types.includes("street_address"))||M[0];let O="";w.address_components.forEach(S=>{const B=S.types||[];(B.includes("sublocality_level_1")||B.includes("sublocality")||B.includes("neighborhood"))&&(O=S.long_name.replace(/^Barangay\s*/i,""))});const A=w.formatted_address||"";n({fullAddress:A,street:A,barangay:O,coords:k})}})},[n]),N=a.useCallback(k=>{if(!window.google)return u({distanceText:null,distanceKm:null});new window.google.maps.DistanceMatrixService().getDistanceMatrix({origins:[x],destinations:[k],travelMode:window.google.maps.TravelMode.DRIVING,unitSystem:window.google.maps.UnitSystem.METRIC},(M,p)=>{var w;if(p==="OK"&&M.rows[0]&&M.rows[0].elements[0]){const O=M.rows[0].elements[0],A=O.distance?O.distance.value/1e3:null;u({distanceText:(w=O.distance)==null?void 0:w.text,distanceKm:A})}else u({distanceText:null,distanceKm:null})})},[x,u]),y=()=>{if(!c)return;const k=c.getPlace();if(!k||!k.geometry)return;const b={lat:k.geometry.location.lat(),lng:k.geometry.location.lng()};h(b),r(b),l(b),N(b)},D=()=>{if(!navigator.geolocation)return alert("GPS not available.");navigator.geolocation.getCurrentPosition(k=>{const b={lat:k.coords.latitude,lng:k.coords.longitude};h(b),r(b),l(b),N(b)},()=>alert("Unable to fetch your location."))};return i?e.jsxs("div",{className:"w-full rounded-lg overflow-hidden border mb-4",style:{borderColor:R},children:[e.jsx("div",{className:"p-2 text-center text-sm font-semibold text-white",style:{backgroundColor:R},children:"ðŸ“ Interactive Map â€” drag pin, search, or use GPS"}),e.jsxs("div",{className:"p-2 bg-gray-100",children:[e.jsx(Ie,{onLoad:g,onPlaceChanged:y,children:e.jsx("input",{type:"text",placeholder:"Search street / landmark (autocomplete)",className:"w-full p-3 border rounded-lg"})}),e.jsx("button",{onClick:D,className:"mt-2 w-full p-2 rounded-lg font-semibold",style:{backgroundColor:R,color:"white"},children:"ðŸ“Œ Use My Location"})]}),e.jsx(Ee,{center:m,zoom:15,mapContainerStyle:{width:"100%",height:"320px"},children:e.jsx(ue,{position:d,draggable:!0,onDragEnd:k=>{const b={lat:k.latLng.lat(),lng:k.latLng.lng()};r(b),l(b),N(b)}})})]}):e.jsx("div",{className:"p-4",children:"Loading mapâ€¦"})},be=["Abuno","Acmac","Bagong Silang","Bonbonon","Bunawan","Buruâ€‘un","Dalipuga","Del Carmen","Digkilaan","Ditucalan","Dulag","Hinaplanon","Hindang","Kabacsanan","Kalilangan","Kiwalan","Lanipao","Luinab","Mahayahay","Mainit","Mandulog","Maria Cristina","Palaâ€‘o","Panoroganan","Poblacion","Pugaâ€‘an","Rogongon","San Miguel","San Roque","Sarayâ€‘Tibanga","Santa Elena","Santa Filomena","Santo Rosario","Suarez","Tambacan","Tibanga","Tipanoy","Tomas Cabili","Tubod","Ubaldo Laya","Upper Hinaplanon","Upper Tominobo","Villa Verde"],Ve=({setPage:n,cart:u,setCart:x,user:s})=>{var ce;const[i,m]=a.useState({name:"",phone:"",addressDetail:"",barangay:be[0],payment:"COD"}),[h,d]=a.useState(null),[r,c]=a.useState(""),[g,l]=a.useState(null),[N,y]=a.useState(null),[D,k]=a.useState(!0),[b,M]=a.useState([]),[p,w]=a.useState(null),[O,A]=a.useState(""),[S,B]=a.useState(!1),[C,L]=a.useState(!1),[z,J]=a.useState(null),f=a.useMemo(()=>u.reduce((j,P)=>j+P.price*P.quantity,0),[u]),$=j=>j==null?50:j<=2?30:j<=5?50:70,K=a.useMemo(()=>$(g),[g]),re=(j,P)=>{if(!j||!P)return null;const U=ee=>ee*Math.PI/180,G=6371,I=U(P.lat-j.lat),H=U(P.lng-j.lng),t=U(j.lat),o=U(P.lat),v=Math.sin(I/2),_=Math.sin(H/2),F=v*v+_*_*Math.cos(t)*Math.cos(o);return G*2*Math.atan2(Math.sqrt(F),Math.sqrt(1-F))},le=j=>j==null?null:Math.max(5,Math.ceil(j/25*60)),se=a.useCallback(j=>{if(!b||b.length===0||!j)return null;let P=null,U=1/0;return b.forEach(G=>{if(G.lat==null||G.lng==null)return;const I=re(j,{lat:G.lat,lng:G.lng});I<U&&(U=I,P={...G,distanceKm:I})}),P},[b]),ne=a.useCallback(({fullAddress:j,street:P,barangay:U,coords:G})=>{if(m(I=>({...I,addressDetail:P&&P.length>0?P:j||I.addressDetail,barangay:U&&U.length>0?U:I.barangay})),d(G),G){const I=se(G);I&&w(I);const H=I?re(G,{lat:I.lat,lng:I.lng}):null;l(H),y(le(H))}},[se]),Q=a.useCallback(({distanceText:j,distanceKm:P})=>{c(j||""),l(P),y(le(P))},[]),oe=()=>`Iligan City, Brgy. ${i.barangay} â€¢ ${i.addressDetail}`,ge=async()=>{if(A(""),!i.name||!i.phone||!i.barangay||!i.addressDetail){A("Please fill Recipient Name, Phone, Barangay, and Full Address details.");return}if(u.length===0){A("Your cart is empty.");return}if(!D){A("Address is outside our delivery area.");return}B(!0);try{const j=oe(),{data:P,error:U}=await E.from("orders").insert([{user_id:s==null?void 0:s.id,contact_name:i.name,contact_phone:i.phone,shipping_address:j,payment_method:i.payment,status:"Pending",total:f+K}]).select().single();if(U)throw new Error(U.message);const G=u.map(H=>({order_id:P.id,food_item_id:H.id,name:H.name,price:H.price,quantity:H.quantity})),{error:I}=await E.from("order_items").insert(G);if(I)throw new Error(I.message);J(P),L(!0),x([]),A("")}catch(j){A("Failed to place order. "+(j.message||j))}finally{B(!1)}},fe=()=>{L(!1),n("tracking",z)};return a.useEffect(()=>{k(be.includes(i.barangay))},[i.barangay]),a.useEffect(()=>{if(!(s!=null&&s.id))return;let j=!1;return(async()=>{try{const{data:U,error:G}=await E.from("user_profiles").select("full_name, phone, address, barangay").eq("id",s.id).single();if(j||G)return;U&&m(I=>({...I,name:U.full_name||I.name,phone:U.phone||I.phone,addressDetail:U.address||I.addressDetail,barangay:U.barangay||I.barangay}))}catch{}})(),()=>{j=!0}},[s]),e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8 max-w-sm w-full text-center space-y-4 animate-bounce",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âœ…"}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:q},children:"Order Placed Successfully!"}),e.jsxs("p",{className:"text-gray-600",children:["Order ID: ",e.jsxs("strong",{children:["#",(ce=z==null?void 0:z.id)==null?void 0:ce.slice(-6)]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your order has been confirmed. You'll receive updates on your phone."}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(W,{onClick:fe,children:"Track My Order ðŸš—"}),e.jsx("button",{onClick:()=>L(!1),className:"w-full py-2 text-gray-600 font-semibold hover:bg-gray-100 rounded-lg transition",children:"Continue Shopping"})]})]})}),e.jsxs("div",{className:"p-4 md:p-6 mx-auto w-full max-w-3xl",children:[e.jsx(he,{icon:"ðŸ›µ",title:"Final Step: Confirm Delivery"}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-xl space-y-6",children:[e.jsxs("div",{className:"border-b pb-4",style:{borderColor:V},children:[e.jsxs("h3",{className:"font-bold text-lg mb-4",style:{color:q},children:[e.jsx("span",{className:"text-xl mr-2",children:"ðŸ "}),"Delivery Details"]}),e.jsx(Ye,{origin:p?{lat:p.lat,lng:p.lng}:{lat:8.228,lng:124.2452},onAddressComponents:ne,onDistanceCalculated:Q}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ae,{placeholder:"Recipient Name",value:i.name,onChange:j=>m(P=>({...P,name:j.target.value})),required:!0}),e.jsx(ae,{type:"tel",placeholder:"Phone Number",value:i.phone,onChange:j=>m(P=>({...P,phone:j.target.value})),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Barangay (Iligan City Only)"}),e.jsx("select",{value:i.barangay,onChange:j=>m(P=>({...P,barangay:j.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg bg-white font-semibold focus:ring-2 focus:ring-offset-0 input-focus-shopee",children:be.map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsx(ae,{placeholder:"Street / Unit / House No.",value:i.addressDetail,onChange:j=>m(P=>({...P,addressDetail:j.target.value})),rows:"3",isTextArea:!0,required:!0})]})]}),e.jsxs("div",{className:"border-b pb-4",style:{borderColor:V},children:[e.jsxs("h3",{className:"font-bold text-lg mb-4",style:{color:q},children:[e.jsx("span",{className:"text-xl mr-2",children:"ðŸ’³"}),"Payment Method"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:i.payment,onChange:j=>m(P=>({...P,payment:j.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg bg-white font-semibold focus:ring-2 focus:ring-offset-0 input-focus-shopee",style:{paddingRight:"2.5rem"},children:[e.jsx("option",{value:"COD",children:"Cash on Delivery (COD) - Preferred"}),e.jsx("option",{value:"E-Wallet",children:"GCash/Maya (E-Wallet)"}),e.jsx("option",{value:"CreditCard",children:"Credit/Debit Card"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("h3",{className:"font-bold text-lg mb-3",style:{color:q},children:[e.jsx("span",{className:"text-xl mr-2",children:"ðŸ§¾"}),"Order Summary"]}),e.jsxs("p",{className:"text-lg flex justify-between mb-2 text-gray-600",children:[e.jsxs("span",{children:["Subtotal (",u.length," items):"]}),e.jsxs("span",{className:"font-semibold",children:["â‚±",f.toFixed(2)]})]}),e.jsxs("p",{className:"text-lg flex justify-between text-gray-600 border-b pb-3 mb-3",style:{borderColor:V},children:[e.jsx("span",{children:"Delivery Fee:"}),e.jsxs("span",{className:"font-semibold",children:["â‚±",K.toFixed(2)]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[r&&e.jsxs(e.Fragment,{children:["ðŸš— Distance: ",e.jsx("strong",{children:r})]}),g!=null&&e.jsxs("span",{children:[" â€¢ ",g.toFixed(2)," km"]})]}),N!=null&&e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["â±ï¸ ETA: ",e.jsxs("strong",{children:[N," min"]})]}),e.jsxs("p",{className:"text-2xl font-extrabold flex justify-between",children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{style:{color:R},children:["â‚±",(f+K).toFixed(2)]})]})]}),O&&e.jsx("p",{className:"text-sm text-red-500 mt-4 font-medium",children:O}),!D&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"This address is outside our delivery area."}),p&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Assigned to: ",e.jsx("strong",{children:p.name})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx(W,{onClick:ge,disabled:S||u.length===0||!D,children:S?"Processing...":"Place Order Now"}),e.jsx(W,{onClick:()=>n("cart"),variant:"secondary",className:"mt-2",children:"â† Back to Basket"})]})]})]})},De=({status:n,size:u="sm"})=>{const s={Pending:{bg:"#FEF3C7",text:"#F59E0B"},Preparing:{bg:"#E0F2F7",text:"#003366"},"Driver Assigned":{bg:"#DBEAFE",text:"#3B82F6"},"Out for Delivery":{bg:"#DBEAFE",text:"#3B82F6"},Delivered:{bg:"#D1FAE5",text:"#10B981"},Completed:{bg:"#D1FAE5",text:"#10B981"},Cancelled:{bg:"#FEE2E2",text:"#EF4444"},Processing:{bg:"#FEF3C7",text:"#F59E0B"}}[n]||{bg:"#F3F4F6",text:"#6B7280"},i=u==="xs"?"text-xs px-2 py-1":"text-sm px-3 py-1";return e.jsx("span",{className:`${i} font-bold rounded-full`,style:{backgroundColor:s.bg,color:s.text},children:n})},He=({setPage:n,user:u,setSelectedOrder:x})=>{const[s,i]=a.useState([]),[m,h]=a.useState(!0),d=a.useCallback(async()=>{if(!u){h(!1);return}h(!0);const{data:r,error:c}=await E.from("orders").select(`
        *,
        order_items (
          food_item_id,
          name,
          price,
          quantity,
          food_items (
            restaurant_id,
            image_url,
            restaurants (
              name,
              image_url
            )
          )
        )
      `).eq("user_id",u.id).order("created_at",{ascending:!1});if(c)console.error("Error fetching orders:",c),i([]);else{const g=r.flatMap(l=>{const N=l.order_items.reduce((y,D)=>{var p;const k=(p=D.food_items)==null?void 0:p.restaurants,b=k==null?void 0:k.name;if(!b)return y;y[b]||(y[b]={restaurantName:k.name,restaurantId:D.food_items.restaurant_id,items:[],subtotal:0});const M=D.price*D.quantity;return y[b].items.push(D),y[b].subtotal+=M,y},{});return Object.values(N).map(y=>({...l,displayId:`${l.id}-${y.restaurantId}`,restaurantName:y.restaurantName,order_items:y.items,total:y.subtotal,createdAt:new Date(l.created_at).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),isSegment:!0}))});i(g)}h(!1)},[u]);return a.useEffect(()=>{d()},[u,d]),m?e.jsx(xe,{}):s.length===0?e.jsxs("div",{className:"p-4 md:p-6 text-center h-full flex flex-col justify-center items-center mx-auto w-full max-w-3xl",children:[e.jsx("span",{className:"text-6xl mb-4",children:"ðŸ˜´"}),e.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:q},children:"No Orders Yet"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"Your food order history will appear here."}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsx(W,{onClick:()=>n("products"),children:"Start Ordering!"})})]}):e.jsxs("div",{className:"p-4 md:p-6 mx-auto w-full max-w-3xl",children:[e.jsx(he,{icon:"ðŸ›µ",title:`My Iligan Orders (${s.length} Segments)`}),e.jsx("div",{className:"space-y-4",children:s.map(r=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-md cursor-pointer transition-all duration-200 hover:shadow-lg hover:border",style:{borderColor:R,border:"1px solid white"},onClick:()=>{x(r),n("details")},children:[e.jsxs("div",{className:"flex justify-between items-start border-b pb-3 mb-3",style:{borderColor:V},children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 leading-tight",children:r.restaurantName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["#",r.id.slice(-6)," (Segment)"]}),e.jsx("span",{className:"text-gray-300",children:"â€¢"}),e.jsx("p",{className:"text-xs text-gray-500",children:r.createdAt})]})]}),e.jsx(De,{status:r.status,size:"xs"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:r.order_items.map(c=>{var g;return e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg p-2",children:[((g=c.food_items)==null?void 0:g.image_url)&&e.jsx("img",{src:c.food_items.image_url,alt:c.name,className:"w-12 h-12 object-cover rounded-md"}),e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsx("span",{className:"font-medium",children:c.name}),e.jsxs("span",{className:"text-gray-500",children:["x",c.quantity]})]})]},c.food_item_id)})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 bg-gray-50 px-2 py-1 rounded-md",children:[r.order_items.length," item",r.order_items.length!==1?"s":""]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-0.5",children:"Subtotal"}),e.jsxs("p",{className:"text-xl font-extrabold leading-none",style:{color:R},children:["â‚±",r.total.toFixed(2)]})]})]})]},r.displayId))})]})},We=({currentOrder:n})=>{const[u,x]=a.useState(pe),s=a.useRef(null),i=a.useRef(0),{isLoaded:m,loadError:h}=ke({googleMapsApiKey:qe}),d=a.useMemo(()=>pe,[]),r=a.useMemo(()=>{const L={default:pe};return["Abuno","Acmac","Bagong Silang","Bonbonon","Bunawan","Buru-un","Dalipuga","Del Carmen","Digkilaan","Ditucalan","Dulag","Hinaplanon","Hindang","Kabacsanan","Kalilangan","Kiwalan","Lanipao","Luinab","Mahayahay","Mainit","Mandulog","Maria Cristina","Palao","Panoroganan","Poblacion","Puga-an","Rogongon","San Miguel","San Roque","Santiago","Saray","Santa Elena","Santa Filomena","Santo Rosario","Suarez","Tambacan","Tibanga","Tipanoy","Tomas L. Cabili","Tubod","Ubaldo Laya","Upper Hinaplanon","Upper Tominobo","Villa Verde"].forEach((J,f)=>{L[J]||(L[J]={lat:8.228+f%5*.01*.1,lng:124.2452+Math.floor(f/5)%5*.01*.1})}),L},[]),c=a.useMemo(()=>{const S=(n.shipping_address||"").toString();let B="default";for(const C of Object.keys(r))if(C!=="default"&&S.includes(`Brgy. ${C}`)){B=C;break}return r[B]||r.default},[n.shipping_address,r]),g=n.status==="Delivered"||n.status==="Completed",l=Y.indexOf(n.status)>=Y.indexOf("Out for Delivery"),N="Iligan City, Lanao del Norte, Philippines",y=n.shipping_address,D={width:"100%",height:"200px"},k=g?"Order Delivered Successfully!":l?"Tracking: Rider is en route to your location.":"Pending: Restaurant is preparing your food.",b=Y.indexOf(n.status),M=Y.indexOf("Delivered"),p=M>0?Math.min(100,Math.max(0,b/M*100)):0,w=l?c:d,A={url:`data:image/svg+xml;utf8,${encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
      <circle cx="24" cy="24" r="20" fill="${encodeURIComponent(R)}" stroke="#fff" stroke-width="2"/>
      <path fill="#fff" d="M18 25c0 1.66 1.34 3 3 3s3-1.34 3-3V19h-6v6zm6 0c0 1.66 1.34 3 3 3s3-1.34 3-3V19h-6v6zM24 8c-4.42 0-8 3.58-8 8v16h16V16c0-4.42-3.58-8-8-8z"/>
      <text x="24" y="30" font-family="Arial" font-size="12" fill="#fff" text-anchor="middle">ðŸ›µ</text>
    </svg>
  `)}`,scaledSize:{width:48,height:48},anchor:{x:24,y:24}};return a.useEffect(()=>{if(x(d),i.current=0,!l||g){s.current&&(clearInterval(s.current),s.current=null);return}const S=8e3,B=50,C=Math.max(1,Math.floor(S/B));let L=0;return s.current&&(clearInterval(s.current),s.current=null),s.current=setInterval(()=>{L++;const z=Math.min(1,L/C);i.current=z;const J=d.lat+(c.lat-d.lat)*z,f=d.lng+(c.lng-d.lng)*z;x({lat:J,lng:f}),z>=1&&(clearInterval(s.current),s.current=null)},B),()=>{s.current&&(clearInterval(s.current),s.current=null)}},[l,c.lat,c.lng,d.lat,d.lng,g,d]),h?e.jsx("div",{className:"h-48 bg-red-100 rounded-xl flex items-center justify-center text-center p-4",children:e.jsx("p",{className:"text-red-700 font-bold",children:"Map Error: Check your Google Maps API Key!"})}):m?e.jsxs("div",{className:"mt-4 p-4 border rounded-xl bg-white shadow-inner",children:[e.jsx("h4",{className:"font-bold mb-2 text-lg",style:{color:q},children:"Tracking Status"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"rounded-t-lg overflow-hidden border-b-2",style:{borderColor:q},children:e.jsxs(Ee,{mapContainerStyle:D,center:l?u:w,zoom:l?14:12,options:{disableDefaultUI:!0,zoomControl:!0},children:[e.jsx(ue,{position:d,label:{text:"Shop",className:"map-label-origin",color:"white"}}),e.jsx(ue,{position:c,label:{text:"You",className:"map-label-destination",color:"white"}}),l&&!g&&e.jsx(ue,{position:u,icon:A})]})}),l&&!g&&e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 rounded-full z-10",style:{backgroundColor:q},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-1000",style:{width:`${p}%`,backgroundColor:R}})}),e.jsx("div",{className:"relative bottom-0 left-0 right-0 text-center py-2 rounded-b-lg text-white font-bold",style:{backgroundColor:l?R:q},children:k})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[e.jsx("p",{children:"Delivery Partner: Local Iligan Rider (Mock)"}),e.jsxs("p",{children:["Reference No: FOOD-ILIGAN-",n.id.slice(0,8).toUpperCase()]}),e.jsxs("p",{className:"font-semibold mt-1",children:["Source: ",N," | Destination: ",y]})]})]}):e.jsx("div",{className:"h-48 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx(xe,{})})},Je=({order:n,setPage:u,user:x})=>{const[s,i]=a.useState(n),[m,h]=a.useState({name:s.restaurantName||"Loading...",address:"Locating restaurant..."}),d=s.status==="Delivered"||s.status==="Completed",r=Y.indexOf(s.status)===Y.indexOf("Delivered"),c=Y.indexOf(s.status)<=Y.indexOf("Preparing");a.useEffect(()=>{(async()=>{var O;const N=(O=s.order_items)==null?void 0:O[0],y=N==null?void 0:N.food_items,D=y==null?void 0:y.restaurants,k=y==null?void 0:y.restaurant_id;let b=(D==null?void 0:D.name)||s.restaurantName,M=D==null?void 0:D.address_street,p=D==null?void 0:D.address_barangay;if(k&&(!p||!b)){const{data:A,error:S}=await E.from("restaurants").select("name, address_street, address_barangay").eq("id",k).single();A&&!S&&(b=A.name,M=A.address_street,p=A.address_barangay)}const w=[M,p,"Iligan City"].filter(Boolean).join(", ");h({name:b||"Unknown Restaurant",address:w||"Address not available"})})()},[s]);const g=async l=>{!["Cancelled","Completed"].includes(l)&&l!==Y[Y.indexOf(s.status)+1]&&console.warn(`User status update to ${l} is not allowed.`);try{const{error:y}=await E.from("orders").update({status:l}).eq("id",s.id).eq("user_id",x.id);if(y)throw y;i(D=>({...D,status:l}))}catch(y){console.error("Error updating status:",y)}};return e.jsxs("div",{className:"p-4 md:p-6 mx-auto w-full max-w-3xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-4",style:{borderColor:V},children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:q},children:"Order Tracking"}),e.jsxs("button",{onClick:()=>u("history"),className:"text-base font-bold flex items-center hover:underline transition-all",style:{color:R},children:[e.jsx("span",{className:"mr-1",children:"â†"})," Back"]})]}),e.jsx("div",{className:"mb-4 p-4 bg-white rounded-xl shadow-sm border border-l-4",style:{borderColor:V,borderLeftColor:R},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:"Order From"}),e.jsx("h3",{className:"text-xl font-extrabold leading-tight",style:{color:q},children:m.name}),e.jsxs("div",{className:"flex items-start mt-2",children:[e.jsx("span",{className:"text-lg mr-1",children:"ðŸ“"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:m.address})]})]}),e.jsx(De,{status:s.status})]})}),e.jsxs("div",{className:"mb-6 p-4 bg-white rounded-xl shadow-md",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("p",{className:"font-medium text-sm text-gray-600",children:["Order ID: ",e.jsxs("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:["#",s.id.slice(-6)]})]})}),e.jsx(We,{currentOrder:s}),e.jsxs("div",{className:"mt-6 space-y-3",children:[r&&e.jsx(W,{onClick:()=>g("Completed"),children:"CONFIRM ORDER RECEIVED"}),c&&e.jsx(W,{onClick:()=>g("Cancelled"),variant:"secondary",children:"Cancel Order"}),!d&&!c&&s.status!=="Cancelled"&&Y.indexOf(s.status)<Y.length-2&&e.jsxs("button",{onClick:()=>g(Y[Y.indexOf(s.status)+1]),className:"w-full text-center text-xs py-2 border border-dashed rounded-lg font-bold opacity-60 hover:opacity-100 transition-opacity",style:{color:q,borderColor:q},children:["(Demo) Advance Status to: ",Y[Y.indexOf(s.status)+1]]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-md mb-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-3 border-b pb-2",style:{color:q},children:"Items Ordered"}),e.jsx("div",{className:"space-y-3",children:s.order_items.map((l,N)=>{var y;return e.jsxs("div",{className:"flex justify-between items-center text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[((y=l.food_items)==null?void 0:y.image_url)&&e.jsx("img",{src:l.food_items.image_url,alt:l.name,className:"w-12 h-12 object-cover rounded-md"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["x",l.quantity]})]})]}),e.jsxs("p",{className:"font-semibold text-base",children:["â‚±",(l.price*l.quantity).toFixed(2)]})]},l.food_item_id||N)})}),e.jsx("div",{className:"border-t mt-4 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-800",children:"TOTAL"}),e.jsxs("span",{className:"text-xl font-extrabold",style:{color:R},children:["â‚±",s.total.toFixed(2)]})]})})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-md text-sm",children:[e.jsxs("h3",{className:"font-bold text-lg mb-3 flex items-center gap-2",style:{color:q},children:[e.jsx("span",{children:"ðŸ "})," Delivery Destination"]}),e.jsxs("div",{className:"pl-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase font-bold",children:"Recipient"}),e.jsxs("p",{className:"text-gray-800 font-medium",children:[s.contact_name," (",s.contact_phone,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase font-bold",children:"Address"}),e.jsx("p",{className:"text-gray-800 font-medium",children:s.shipping_address})]})]})]})]})},Z="#FF8A00",T="#003366",we="#F7F7F7",Pe="#6B7280",me="#D1D5DB",Ze=["Pending","Preparing","Driver Assigned","Out for Delivery","Delivered","Completed","Cancelled"],_e="restaurantOwnerStatusFilter",X=n=>e.jsx("input",{className:"w-full p-3 border rounded-lg bg-gray-50 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500",style:{borderColor:me},...n}),Xe=({children:n,onClick:u,disabled:x})=>e.jsx("button",{onClick:u,disabled:x,className:"w-full py-3 text-white rounded-lg font-bold transition duration-150 ease-in-out shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed",style:x?{}:{backgroundColor:Z},children:n}),ye=()=>e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("p",{className:"text-lg font-semibold",style:{color:T},children:"Loading..."})}),Qe=({onSuccess:n})=>{const[u,x]=a.useState(""),[s,i]=a.useState(""),[m,h]=a.useState(""),[d,r]=a.useState(""),[c,g]=a.useState(""),[l,N]=a.useState(""),[y,D]=a.useState(""),[k,b]=a.useState([]),[M,p]=a.useState([]),[w,O]=a.useState(!0),[A,S]=a.useState(""),[B,C]=a.useState(!1),[L,z]=a.useState("");a.useEffect(()=>{(async()=>{const{data:$}=await E.from("delivery_zones").select("barangay_name");$&&b($);const{data:K}=await E.from("categories").select("id, name");K&&p(K)})()},[]);const J=async()=>{if(S(""),z(""),C(!0),!u||!s){S("Please fill in both email and password."),C(!1);return}if(!w&&(!m||!d||!l||!y)){S("Your Name, Restaurant Name, Barangay, and Category are required for registration."),C(!1);return}try{let f;if(w){if(f=await E.auth.signInWithPassword({email:u,password:s}),f.error)throw f.error;await new Promise($=>setTimeout($,500)),n(f.data.user)}else{if(f=await E.auth.signUp({email:u,password:s,options:{data:{user_type:"restaurant_owner"},emailRedirectTo:window.location.origin}}),f.error)throw f.error;const $=f.data.user;if($&&f.data.session){const{error:K}=await E.from("owners").insert({id:$.id,contact_name:m});if(K)throw new Error(`Failed to create owner profile: ${K.message}`);let re=3,le=!1;for(;re>0&&!le;){const{error:Q}=await E.from("restaurants").insert({name:d,address_street:c,address_barangay:l,category_id:y,owner_id:$.id,is_open:!0});if(!Q)le=!0;else if(re>1)await new Promise(oe=>setTimeout(oe,1e3)),re--;else throw new Error(`Failed to register restaurant: ${Q.message}`)}await new Promise(Q=>setTimeout(Q,1e3));const{data:se,error:ne}=await E.from("restaurants").select("id, name").eq("owner_id",$.id).single();if(ne||!se)throw new Error("Restaurant was created but could not be verified. Please try logging in again.");z(`âœ… Success! Restaurant "${se.name}" registered. Redirecting...`),await new Promise(Q=>setTimeout(Q,1500)),n($)}else f.data.session===null&&(z("Account created! Please check your email to confirm before logging in."),setTimeout(()=>O(!0),3e3))}}catch(f){console.error(f),S(f.message||"Authentication failed. Please try again.")}finally{C(!1)}};return e.jsx("div",{className:"min-h-screen flex justify-center items-center py-10",style:{backgroundColor:we},children:e.jsxs("div",{className:"p-6 md:p-10 bg-white rounded-2xl shadow-2xl mx-4 w-full max-w-md h-auto overflow-y-auto max-h-[90vh]",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"ðŸ½ï¸"}),e.jsx("h2",{className:"text-3xl font-extrabold",style:{color:Z},children:w?"Owner Login":"Register Restaurant"})]}),e.jsxs("div",{className:"space-y-3",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Your Full Name"}),e.jsx(X,{type:"text",placeholder:"e.g., Juan Dela Cruz",value:m,onChange:f=>h(f.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Restaurant Name"}),e.jsx(X,{type:"text",placeholder:"e.g., Jollibee Tubod",value:d,onChange:f=>r(f.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Barangay"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg bg-gray-50 text-sm",value:l,onChange:f=>N(f.target.value),style:{borderColor:me},children:[e.jsx("option",{value:"",children:"Select Zone"}),k.map(f=>e.jsx("option",{value:f.barangay_name,children:f.barangay_name},f.barangay_name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Street"}),e.jsx(X,{type:"text",placeholder:"Street/Bldg",value:c,onChange:f=>g(f.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Category"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg bg-gray-50 text-sm",value:y,onChange:f=>D(f.target.value),style:{borderColor:me},children:[e.jsx("option",{value:"",children:"Select Category"}),M.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Email"}),e.jsx(X,{type:"email",placeholder:"owner@business.com",value:u,onChange:f=>x(f.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Password"}),e.jsx(X,{type:"password",placeholder:"******",value:s,onChange:f=>i(f.target.value)})]})]}),A&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600 font-medium",children:A})}),L&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-600 font-medium",children:L})}),e.jsx("div",{className:"mt-6",children:e.jsx(Xe,{onClick:J,disabled:B,children:B?"Processing...":w?"Login":"Register & Create Restaurant"})}),e.jsxs("p",{className:"mt-4 text-center text-sm",style:{color:Pe},children:[w?"New partner?":"Existing user?",e.jsx("button",{onClick:()=>{O(!w),S(""),z("")},className:"ml-2 font-bold hover:underline",style:{color:Z},disabled:B,children:w?"Register":"Login"})]})]})})},et=()=>{const[n,u]=a.useState(null),[x,s]=a.useState(!1),[i,m]=a.useState([]),[h,d]=a.useState(!0),[r,c]=a.useState(null),[g,l]=a.useState(null),[N,y]=a.useState(!1),[D,k]=a.useState(0),[b,M]=a.useState("orders"),[p,w]=a.useState([]),[O,A]=a.useState(!1),[S,B]=a.useState(null),[C,L]=a.useState({name:"",price:"",stock:"",description:"",image_url:""}),[z,J]=a.useState(!1),[f,$]=a.useState({name:"",address_street:"",address_barangay:"",imageFile:null,imagePreview:""}),[K,re]=a.useState(()=>typeof window<"u"&&localStorage.getItem(_e)||"all");a.useEffect(()=>{typeof window<"u"&&localStorage.setItem(_e,K)},[K]),a.useEffect(()=>{let t=!0;(async()=>{const{data:{session:_}}=await E.auth.getSession();t&&(u((_==null?void 0:_.user)??null),s(!0))})();const{data:{subscription:v}}=E.auth.onAuthStateChange((_,F)=>{t&&(u((F==null?void 0:F.user)??null),s(!0),y(!1),k(0))});return()=>{t=!1,v==null||v.unsubscribe()}},[]);const le=a.useCallback(async(t,o)=>{try{const{error:v}=await E.from("orders").update({status:o}).eq("id",t).select();if(v)throw v;m(i.map(_=>_.id===t?{..._,status:o}:_))}catch(v){alert('Failed to update status. Check RLS policies on "orders".'),console.error(v)}},[i]),se=a.useCallback(async()=>{if(r){d(!0);try{const{data:t,error:o}=await E.from("order_items").select(`
                    order_id,
                    name,
                    price,
                    quantity,
                    food_item_id,
                    food_items!inner ( restaurant_id, food_item_id, image_url )
                `).eq("food_items.restaurant_id",r.id);if(o)throw o;const v=[...new Set(t.map(de=>de.order_id))];if(v.length===0){m([]),d(!1);return}const{data:_,error:F}=await E.from("orders").select("*").in("id",v).order("created_at",{ascending:!1});if(F)throw F;const ee=await Promise.all(_.map(async de=>{const Ae=t.filter(te=>te.order_id===de.id),ve=await Promise.all(Ae.map(async te=>{var Ne;const ie=((Ne=te.food_items)==null?void 0:Ne.image_url)||te.image_url||null,Oe=ie?await H(ie):null;return{food_item_id:te.food_item_id,name:te.name,price:te.price,quantity:te.quantity,image_url:Oe}})),Fe=ve.reduce((te,ie)=>te+ie.price*ie.quantity,0);return{...de,order_items:ve,restaurant_subtotal:Fe.toFixed(2)}}));m(ee)}catch(t){console.error("Error loading orders:",t)}finally{d(!1)}}},[r]),ne=a.useCallback(async()=>{if(r)try{const{data:t,error:o}=await E.from("food_items").select("*").eq("restaurant_id",r.id).order("name");if(o)throw o;const v=await Promise.all((t||[]).map(async _=>({..._,image_url:_.image_url?await H(_.image_url):null})));w(v)}catch(t){console.error("Error loading products:",t)}},[r]),Q=async()=>{if(!C.name||!C.price||!C.stock){alert("Please fill in all required fields (Name, Price, Stock)");return}try{const t={food_item_id:(S==null?void 0:S.food_item_id)||`${r.id}_${Date.now()}`,name:C.name,price:parseFloat(C.price),stock:parseInt(C.stock),description:C.description,image_url:C.image_url,restaurant_id:r.id};if(S){const{error:o}=await E.from("food_items").update(t).eq("food_item_id",S.food_item_id);if(o)throw o}else{const{error:o}=await E.from("food_items").insert(t);if(o)throw o}await ne(),A(!1),B(null),L({name:"",price:"",stock:"",description:"",image_url:""})}catch(t){console.error("Error saving product:",t),alert("Failed to save product: "+t.message)}},oe=async t=>{if(confirm("Are you sure you want to delete this product?"))try{const{error:o}=await E.from("food_items").delete().eq("food_item_id",t);if(o)throw o;await ne()}catch(o){console.error("Error deleting product:",o),alert("Failed to delete product: "+o.message)}},ge=t=>{B(t),L({name:t.name,price:t.price.toString(),stock:t.stock.toString(),description:t.description||"",image_url:t.image_url||""}),A(!0)},fe=t=>{var v;const o=((v=t.target.files)==null?void 0:v[0])||null;o&&$(_=>({..._,imageFile:o,imagePreview:URL.createObjectURL(o)}))},ce=async t=>{if(!t)return null;try{const o=`${r.id}/${Date.now()}_${t.name}`,{error:v}=await E.storage.from("restaurant-images").upload(o,t,{upsert:!0});if(v){const F=(v.message||v.error_description||"").toString();throw F.toLowerCase().includes("bucket")||F.toLowerCase().includes("not found")?new Error('Bucket "restaurant-images" not found. Create a public storage bucket named "restaurant-images" in your Supabase project or update the bucket name in the frontend code.'):v}const{data:_}=E.storage.from("restaurant-images").getPublicUrl(o);return(_==null?void 0:_.publicUrl)||null}catch(o){throw console.error("Upload error:",o),o}},j=async()=>{if(r){d(!0);try{let t=f.imagePreview||r.image_url||null;if(f.imageFile)try{t=await ce(f.imageFile)}catch(_){if((_.message||"").toLowerCase().includes('bucket "restaurant-images" not found'))alert('Upload failed: storage bucket "restaurant-images" not found. Restaurant will be saved without the image. Create the bucket in Supabase Storage (public) or change the bucket name in the code.'),t=r.image_url||null;else throw _}const{error:o}=await E.from("restaurants").update({name:f.name,address_street:f.address_street,address_barangay:f.address_barangay,image_url:t}).eq("id",r.id);if(o)throw o;const{data:v}=await E.from("restaurants").select("*").eq("id",r.id).single();c(v),J(!1)}catch(t){console.error("Failed to save restaurant:",t),alert("Failed to save restaurant: "+(t.message||t))}finally{d(!1)}}};a.useEffect(()=>{if(!n||N)return;let t=!0,o;return n&&(async()=>{d(!0);try{const{data:_,error:F}=await E.from("restaurants").select("*").eq("owner_id",n.id).single();if(t){if(F&&F.code==="PGRST116"){if(D<3){console.log(`Restaurant not found, retrying... (attempt ${D+1}/3)`),k(ee=>ee+1),o=setTimeout(()=>{y(!1)},2e3);return}}else F&&console.error("Error fetching restaurant:",F);c(_||null),_&&$(ee=>({...ee,name:_.name||"",address_street:_.address_street||"",address_barangay:_.address_barangay||"",imagePreview:_.image_url||""})),y(!0)}}catch(_){t&&(console.error(_),c(null),y(!0))}finally{t&&d(!1)}})(),()=>{t=!1,o&&clearTimeout(o)}},[n,N,D]),a.useEffect(()=>{r&&(se(),ne())},[r,se,ne]);const P=async()=>{await E.auth.signOut(),u(null),c(null),m([]),y(!1),k(0)},U=a.useMemo(()=>i.filter(t=>K==="all"||t.status===K),[i,K]),G=t=>{let o=Pe,v="#F3F4F6";t==="Pending"&&(o="#F59E0B",v="#FEF3C7"),t==="Preparing"&&(o=T,v="#E0F2F7"),(t==="Driver Assigned"||t==="Out for Delivery")&&(o="#3B82F6",v="#DBEAFE"),(t==="Delivered"||t==="Completed")&&(o="#10B981",v="#D1FAE5"),t==="Cancelled"&&(o="#EF4444",v="#FEE2E2");const _=t==="Pending"?"rod-badge-pulse":"";return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${_}`,style:{color:o,backgroundColor:v},children:t})},I=t=>({Pending:"Preparing",Preparing:"Driver Assigned","Driver Assigned":"Out for Delivery","Out for Delivery":"Delivered",Delivered:"Completed"})[t]||null,H=async t=>{if(!t)return null;let o=t;if(typeof o=="object"&&(o=o.url||o.path||o.publicUrl||o.public_url||o.publicURL||o.path_with_namespace||null),!o)return null;if(o=String(o).trim(),/^https?:\/\//i.test(o)||o.startsWith("data:"))return o;o=o.replace(/^\/+/,"");const v=["food-images","restaurant-images"];for(const _ of v)try{const{data:F}=E.storage.from(_).getPublicUrl(o),ee=(F==null?void 0:F.publicUrl)||(F==null?void 0:F.publicURL)||(F==null?void 0:F.public_url)||(F==null?void 0:F.url);if(ee)return ee}catch{}return null};return a.useEffect(()=>{let t=!0;return(async()=>{if(!(r!=null&&r.image_url))return;const o=r.image_url;if(!(typeof o=="string"&&(/^https?:\/\//i.test(o)||o.startsWith("data:"))))try{const v=await H(o);t&&v&&v!==o&&c(_=>({..._||{},image_url:v}))}catch{}})(),()=>{t=!1}},[r==null?void 0:r.image_url]),x?n?!N||h&&!r?e.jsx(ye,{}):!r&&N?e.jsx("div",{className:"min-h-screen flex items-center justify-center flex-col p-10",style:{backgroundColor:we},children:e.jsxs("div",{className:"bg-white p-10 rounded-xl shadow-2xl text-center max-w-lg",children:[e.jsx("span",{className:"text-6xl mb-4 block",children:"âš ï¸"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:T},children:"No Restaurant Linked"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Please logout and register again using the Owner Registration form."}),e.jsx("button",{onClick:P,className:"px-6 py-3 rounded-lg font-bold text-white transition",style:{backgroundColor:Z},children:"Logout & Try Again"})]})}):e.jsxs("div",{className:"min-h-screen rod-dashboard",style:{backgroundColor:we},children:[e.jsx("header",{className:"shadow-lg p-4 sticky top-0 z-20",style:{backgroundColor:T},children:e.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center text-white",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[r!=null&&r.image_url?e.jsx("img",{src:r.image_url,alt:r.name,className:"w-14 h-14 object-cover rounded-lg border"}):e.jsx("div",{className:"w-14 h-14 rounded-lg bg-white/10 flex items-center justify-center text-2xl",children:"ðŸ´"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-black",children:["ðŸ‘¨â€ðŸ³ ",r.name]}),e.jsx("p",{className:"text-xs opacity-90",children:r.address_barangay})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>J(!0),className:"px-3 py-1.5 rounded-full bg-white/20 hover:bg-white/30 text-sm font-bold rod-btn",children:"Edit"}),e.jsx("button",{onClick:P,className:"px-4 py-1.5 rounded-full bg-white/20 hover:bg-white/30 text-sm font-bold rod-btn",children:"Logout"})]})]})}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:T},children:"Edit Restaurant"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Restaurant Name"}),e.jsx(X,{type:"text",value:f.name,onChange:t=>$(o=>({...o,name:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Street"}),e.jsx(X,{type:"text",value:f.address_street,onChange:t=>$(o=>({...o,address_street:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Barangay"}),e.jsx(X,{type:"text",value:f.address_barangay,onChange:t=>$(o=>({...o,address_barangay:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Restaurant Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:fe}),f.imagePreview&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:f.imagePreview,alt:"preview",className:"w-full h-48 object-cover rounded-lg"})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{J(!1)},className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:j,className:"flex-1 py-3 text-white rounded-lg font-bold hover:opacity-90 transition",style:{backgroundColor:Z},children:"Save"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 md:px-6",children:e.jsxs("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>M("orders"),className:`pb-3 px-4 font-bold transition ${b==="orders"?"border-b-2 text-orange-600":"text-gray-500"}`,style:b==="orders"?{borderColor:Z}:{},children:"ðŸ“‹ Orders"}),e.jsx("button",{onClick:()=>M("products"),className:`pb-3 px-4 font-bold transition ${b==="products"?"border-b-2 text-orange-600":"text-gray-500"}`,style:b==="products"?{borderColor:Z}:{},children:"ðŸ” Products"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[b==="orders"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm",children:[e.jsx("h2",{className:"font-bold text-lg",style:{color:T},children:"Orders Queue"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:K,onChange:t=>re(t.target.value),className:"p-2 border rounded-lg bg-gray-50 text-sm font-semibold",children:[e.jsx("option",{value:"all",children:"All Orders"}),Ze.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("button",{onClick:se,className:"p-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"ðŸ”„"})]})]}),h?e.jsx(ye,{}):U.length===0?e.jsxs("div",{className:"text-center py-20 opacity-50",children:[e.jsx("span",{className:"text-5xl",children:"ðŸ“¦"}),e.jsx("p",{className:"mt-4 font-bold",children:"No orders found."})]}):e.jsx("div",{className:"space-y-4",children:U.map(t=>e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border-l-4 rod-card",style:{borderLeftColor:t.status==="Completed"||t.status==="Delivered"?"#10B981":Z},children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4 pb-3 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800",children:["Order ID: #",t.id.slice(0,8)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," â€¢ ",new Date(t.created_at).toLocaleDateString()]})]}),G(t.status)]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-xs uppercase font-bold tracking-wider",children:"Customer"}),e.jsx("p",{className:"font-semibold",children:t.contact_name}),e.jsx("p",{className:"text-gray-600",children:t.contact_phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-xs uppercase font-bold tracking-wider",children:"Restaurant Total"}),e.jsxs("p",{className:"font-bold text-lg",style:{color:T},children:["â‚±",t.restaurant_subtotal]}),e.jsx("p",{className:"text-gray-500 text-xs uppercase font-bold tracking-wider mt-2",children:"Delivery Address"}),e.jsx("p",{className:"text-gray-600 truncate",children:t.shipping_address})]})]}),e.jsxs("button",{"aria-expanded":g===t.id,onClick:()=>l(g===t.id?null:t.id),className:"w-full text-left bg-gray-50 p-3 rounded-lg flex justify-between items-center hover:bg-gray-100 transition rod-toggle",children:[e.jsxs("span",{className:"font-bold text-sm text-gray-700",children:["View Items (",t.order_items.length,")"]}),e.jsx("span",{className:"text-gray-400",children:g===t.id?"â–²":"â–¼"})]}),g===t.id&&e.jsx("div",{className:"mt-2 bg-gray-50 rounded-lg p-3 space-y-2 border border-gray-100",children:t.order_items.map((o,v)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-100 rounded overflow-hidden flex items-center justify-center",children:o.image_url?e.jsx("img",{src:o.image_url,alt:o.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-xs text-gray-400",children:"No image"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"bg-white px-2 py-0.5 rounded border font-bold text-xs",children:["x",o.quantity]}),e.jsx("span",{className:"font-semibold",children:o.name})]}),o.description&&e.jsx("div",{className:"text-xs text-gray-500",children:o.description})]})]}),e.jsxs("span",{className:"font-mono text-gray-600",children:["â‚±",(o.price*o.quantity).toFixed(2)]})]},o.food_item_id+v))}),t.status!=="Completed"&&t.status!=="Cancelled"&&e.jsxs("div",{className:"mt-5 flex gap-3",children:[I(t.status)&&e.jsxs("button",{onClick:()=>le(t.id,I(t.status)),className:"flex-1 py-3 text-white rounded-lg font-bold hover:opacity-90 transition shadow-lg rod-action-btn",style:{backgroundColor:Z},children:["Mark as ",I(t.status)]}),(t.status==="Pending"||t.status==="Preparing")&&e.jsx("button",{onClick:()=>le(t.id,"Cancelled"),className:"px-4 py-3 bg-red-100 text-red-600 rounded-lg font-bold hover:bg-red-200",children:"Cancel Order"})]})]})},t.id))})]}),b==="products"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm",children:[e.jsx("h2",{className:"font-bold text-lg",style:{color:T},children:"Menu Items"}),e.jsx("button",{onClick:()=>{B(null),L({name:"",price:"",stock:"",description:"",image_url:""}),A(!0)},className:"px-4 py-2 text-white rounded-lg font-bold hover:opacity-90 transition",style:{backgroundColor:Z},children:"+ Add Product"})]}),p.length===0?e.jsxs("div",{className:"text-center py-20 opacity-50",children:[e.jsx("span",{className:"text-5xl",children:"ðŸ½ï¸"}),e.jsx("p",{className:"mt-4 font-bold",children:"No products yet."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden rod-card",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:t.name}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("span",{className:"font-bold text-xl",style:{color:Z},children:["â‚±",t.price]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Stock: ",t.stock]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ge(t),className:"flex-1 py-2 bg-blue-50 text-blue-600 rounded-lg font-bold hover:bg-blue-100",children:"Edit"}),e.jsx("button",{onClick:()=>oe(t.food_item_id),className:"flex-1 py-2 bg-red-50 text-red-600 rounded-lg font-bold hover:bg-red-100",children:"Delete"})]})]})]},t.food_item_id))}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:T},children:S?"Edit Product":"Add New Product"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Product Name *"}),e.jsx(X,{type:"text",placeholder:"e.g., Chicken Adobo",value:C.name,onChange:t=>L({...C,name:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Price (â‚±) *"}),e.jsx(X,{type:"number",placeholder:"99.00",value:C.price,onChange:t=>L({...C,price:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Stock *"}),e.jsx(X,{type:"number",placeholder:"50",value:C.stock,onChange:t=>L({...C,stock:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Description"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg bg-gray-50 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500",style:{borderColor:me},placeholder:"Describe your dish...",rows:"3",value:C.description,onChange:t=>L({...C,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold mb-1",style:{color:T},children:"Image URL"}),e.jsx(X,{type:"text",placeholder:"https://example.com/image.jpg",value:C.image_url,onChange:t=>L({...C,image_url:t.target.value})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{A(!1),B(null)},className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{onClick:Q,className:"flex-1 py-3 text-white rounded-lg font-bold hover:opacity-90 transition",style:{backgroundColor:Z},children:[S?"Update":"Add"," Product"]})]})]})})]})]})]}):e.jsx(Qe,{onSuccess:u}):e.jsx(ye,{})},je="#FF5722",tt="#F5F5F5",st=({setPage:n})=>{const u=()=>{n("products")};return e.jsxs("div",{className:"landing-page-container flex flex-col items-center justify-center w-full h-full p-6 sm:p-10",style:{backgroundColor:tt},children:[e.jsxs("div",{className:"relative w-full max-w-lg mb-10 sm:mb-16 flex justify-center items-center",children:[e.jsx("img",{src:"/motor.png",alt:"Delivery Motor",className:"w-48 sm:w-64 motor-moving-animation"}),e.jsx("div",{className:"absolute top-0 right-0 sm:right-10 p-2 sm:p-3 bg-white rounded-full shadow-lg transform rotate-6",children:e.jsx("span",{className:"text-xl sm:text-2xl",role:"img","aria-label":"Fast Delivery",children:"ðŸ’¨"})})]}),e.jsxs("div",{className:"text-center max-w-xl",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-extrabold mb-4 animate-fade-in",style:{color:je},children:"Your Food, Fast!"}),e.jsx("p",{className:"text-md sm:text-lg text-gray-700 mb-8 sm:mb-10 animate-slide-up",children:"The fastest and easiest way to discover the best local flavors in Iligan City and get them delivered to your door."}),e.jsx("button",{onClick:u,className:"px-8 py-3 sm:px-10 sm:py-4 text-white font-bold rounded-full shadow-xl transition-all duration-300 transform hover:scale-105 hover:shadow-2xl focus:outline-none focus:ring-4",style:{backgroundColor:je,borderColor:je},children:e.jsx("span",{className:"text-lg sm:text-xl",children:"Get Started Now!"})})]})]})},at=()=>{const{user:n,authReady:u}=Be(),[x,s]=a.useState("landing"),[i,m]=a.useState([]),[h,d]=a.useState(null),r=a.useCallback(()=>{E.auth.signOut().then(()=>{m([]),s("auth")}).catch(console.error)},[]),[c,g]=a.useState(!1);a.useEffect(()=>{if(u&&x!=="landing"){if(!n){x!=="auth"&&x!=="restaurant-dashboard"&&s("auth");return}x==="auth"?s("products"):x==="details"&&!h&&s("history"),x!=="details"&&h&&d(null)}},[u,n,x,h]);const l=()=>{if(!u)return e.jsx(xe,{});if(x==="landing")return n?(s("products"),null):e.jsx(st,{setPage:s});if(x==="restaurant-dashboard")return e.jsx(et,{});if(!n)return e.jsx($e,{onSuccess:()=>s("products")});switch(x){case"products":return e.jsx(Ce,{setPage:s,cart:i,setCart:m});case"cart":return e.jsx(ze,{setPage:s,cart:i,setCart:m});case"checkout":return i.length===0?(s("products"),null):e.jsx(Ve,{setPage:s,cart:i,setCart:m,user:n});case"history":return e.jsx(He,{setPage:s,user:n,setSelectedOrder:d});case"details":return h?e.jsx(Je,{order:h,setPage:s,user:n}):(s("history"),null);default:return e.jsx(Ce,{setPage:s,cart:i,setCart:m})}},N=a.useMemo(()=>i.reduce((b,M)=>b+M.quantity,0),[i]),y=[{key:"products",label:"Shops",icon:"ðŸ”"},{key:"cart",label:"Basket",icon:"ðŸ§º",count:N},{key:"history",label:"Orders",icon:"ðŸ›µ"}],D=a.useMemo(()=>n&&n.email?n.email.split("@")[0]:n&&n.id?`User-${n.id.slice(0,4)}`:"Guest",[n]),k=x==="restaurant-dashboard"||x==="landing";return e.jsxs("div",{className:"h-screen flex flex-col items-center w-full",style:{backgroundColor:Ue},children:[!k&&e.jsx("header",{className:"w-full shadow-lg p-3 z-20 sticky top-0",style:{backgroundColor:R},children:e.jsxs("div",{className:"flex justify-between items-center w-full max-w-3xl mx-auto",children:[e.jsxs("div",{className:"logo-container",children:[e.jsx("img",{src:"/logo.png",alt:"ILIGAN Food",className:"logo-img"}),e.jsx("div",{className:"logo-glow"}),e.jsx("div",{className:"logo-pulse"})]}),n&&e.jsxs("div",{className:"flex items-center text-white text-sm",children:[e.jsxs("span",{className:"mr-3 font-semibold hidden sm:inline",children:["Hi, **",D,"**"]}),e.jsx("button",{onClick:()=>g(!0),title:"My Profile",className:"mr-3 w-9 h-9 rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"ðŸ‘¤"})}),e.jsx("button",{onClick:r,className:"px-3 py-1 rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all font-bold",children:"Logout"})]})]})}),e.jsx("main",{className:"w-full flex-1 overflow-y-auto",children:l()}),n&&!k&&e.jsx("nav",{className:"flex-shrink-0 w-full shadow-2xl z-10",style:{backgroundColor:"white",borderTop:`1px solid ${V}`},children:e.jsx("div",{className:"flex justify-around w-full max-w-3xl mx-auto",children:y.map(b=>e.jsxs("button",{onClick:()=>s(b.key),className:`flex flex-col items-center p-2 pt-3 text-xs font-semibold w-full sm:w-3/4 transition-colors relative ${x===b.key?"text-opacity-100":"text-opacity-60"}`,style:{color:R},children:[e.jsx("span",{className:"text-2xl mb-1",children:b.icon}),b.label,b.count>0&&b.key==="cart"&&e.jsx("span",{className:"absolute top-1 right-1/4 transform translate-x-1/2 bg-red-600 text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center",children:b.count})]},b.key))})}),!k&&e.jsx("button",{onClick:()=>s("restaurant-dashboard"),className:"fixed bottom-20 right-4 md:bottom-6 md:right-6 p-4 rounded-full shadow-2xl font-bold text-white transition-all hover:scale-110 z-30",style:{backgroundColor:R},title:"Restaurant Owner Login",children:e.jsx("span",{className:"text-2xl",children:"ðŸ½ï¸"})}),c&&e.jsx(Ge,{user:n,onClose:()=>g(!1)})]})},rt="modulepreload",lt=function(n){return"/"+n},Se={},nt=function(u,x,s){let i=Promise.resolve();if(x&&x.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),d=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));i=Promise.allSettled(x.map(r=>{if(r=lt(r),r in Se)return;Se[r]=!0;const c=r.endsWith(".css"),g=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${g}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":rt,c||(l.as="script"),l.crossOrigin="",l.href=r,d&&l.setAttribute("nonce",d),document.head.appendChild(l),c)return new Promise((N,y)=>{l.addEventListener("load",N),l.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${r}`)))})}))}function m(h){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=h,window.dispatchEvent(d),!d.defaultPrevented)throw h}return i.then(h=>{for(const d of h||[])d.status==="rejected"&&m(d.reason);return u().catch(m)})};function ot(n={}){const{immediate:u=!1,onNeedRefresh:x,onOfflineReady:s,onRegistered:i,onRegisteredSW:m,onRegisterError:h}=n;let d,r;const c=async(l=!0)=>{await r};async function g(){if("serviceWorker"in navigator){if(d=await nt(async()=>{const{Workbox:l}=await import("./vendor-Vxub6Q0z.js").then(N=>N.w);return{Workbox:l}},[]).then(({Workbox:l})=>new l("/sw.js",{scope:"/",type:"classic"})).catch(l=>{h==null||h(l)}),!d)return;d.addEventListener("activated",l=>{(l.isUpdate||l.isExternal)&&window.location.reload()}),d.addEventListener("installed",l=>{l.isUpdate||s==null||s()}),d.register({immediate:u}).then(l=>{m?m("/sw.js",l):i==null||i(l)}).catch(l=>{h==null||h(l)})}}return r=g(),c}ot({immediate:!0});Me(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(at,{})}));
